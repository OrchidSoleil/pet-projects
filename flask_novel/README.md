# CASSANDRA
#### Video Demo:  https://youtu.be/QzqTe8cQrTs
#### Description: Cassandra is a dramatic poem, written by Lesia Ukrainka, which I embodied in this visual novel. It is also my final project for CS50 Harvard online course.

#### Tools: I used flask framework, sqlite3 database, javaScript and AJAX, and some bootstrap. The images were generated using Midjourney AI tool.

#### How it works: upon visiting a link, framework routs user to index.html page, where bootstrap dropdown menu is situated in a place of a navbar, below the image is another menu, that let's user start a new game or visit about.html page.

#### Flask, CSS, bootstrap: When user clicks on 'New Game' menu item, flask routs to a python function /game via GET method, which assigns a variable outcome_id to the start of the story, which is 1. Then outcome_id is sent to an internal python function, named get_data(outcome_id). Then get_data function connects to a sqlite3 database, and creates a cursor, which through try-except executes query, to obtain certain data from three inner joined tables with in-built fetchall() function. To avoid sql-injection attack, I applied parametrization. Then function returns either the data it successfully fetched, or appropriately formatted error message. From here game() function continues. For clarity i use indexation inside this function, and not in an html, to assign correspondent text to variables and then using render_template(), i send this data to game.html.

#### SQLite3: A few words about my tables setup. This is a visual novel, but it gives user a certain amount of freedom, by letting them choose what's the options of the dialog. The main table contains the story text, story location, story chapter, and image path for each story. Another table consists of dialog option choices. The third table, outcome, unites them all, as along with story_id and correspondent choice_id, it contains the story outcome for each dialog option.

#### HTML: As mentioned before, after user clicks on 'New Game' the game() functon renders template of game.html with appropriate data from the database. From here user sees the navbar, kebab drop-down menu, the image, name of location of the story, chapter, first story text and 2 dialog options. Each element in viewport is taken from my sqlite3 database and wrapped in jinja accordingly.

#### AJAX and JavaScript: When user clicks on one of the dialog options, it triggers javaScript's getOutcome(event) function through EventListener, which gets the Attribute 'choice-outcome' from the <p> tag, which was rendered previously by /game function. Then using AJAX post method, this choice-outcome is converted with JSON.stringify() and sent to /game route, which triggers game() function, then is checked for equality to zero and if not, again, sent as parameter to get_data() function. After data is returned, it is jsonified and forwarded as AJAX response. AJAX checks it for content-type, and if it's not text/html, triggers updateHTML javaScript function. This function finds appropriate elements on the page and replaces them with next story_text, location name, image etc.

#### Gameover: AJAX keeps working like that up until JavaScript function getOutcome returns zero. Because then, this zero is sent as usual to the game() function, and inside of it, triggers gameover() function, which renders about.html, with custom message referring to the game end and returns it to then be jsonified and returned as response to AJAX. When AJAX checks for content-type and it's not application/json, but text/html, it replaces all of the HTML of the game.html page with custom about.html response, returned from gameover function.